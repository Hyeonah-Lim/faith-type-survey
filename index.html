<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FATI 신앙유형검사</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #2c3e50;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    .question-text {
      font-size: 18px;
      margin-bottom: 20px;
    }
    .scale-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .scale-label {
      font-size: 14px;
      color: #495057;
      max-width: 90%;
      text-align: center;
    }
    .scale-options {
      display: flex;
      gap: 16px;
    }
    .dot {
      width: 30px;
      height: 30px;
      background: #f1f3f5;
      border: 2px solid #dee2e6;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .dot:hover {
      transform: scale(1.1);
    }
    .dot.selected {
      background: #5B72EE;
      border-color: #4A5FDB;
    }
    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    .next-btn { background: #5B72EE; color: white; }
    .prev-btn { background: #ced4da; color: #343a40; }
    .result-section { display: none; margin-top: 40px; }
    .score-bar-container {
      height: 12px;
      background: #dee2e6;
      border-radius: 6px;
      position: relative;
      margin-bottom: 20px;
    }
    .score-bar-center {
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #adb5bd;
    }
    .score-fill-left, .score-fill-right {
      position: absolute;
      top: 0;
      height: 100%;
      transition: width 0.5s ease;
    }
    .score-fill-left {
      right: 50%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      border-radius: 6px 0 0 6px;
    }
    .score-fill-right {
      left: 50%;
      background: linear-gradient(90deg, #764ba2, #667eea);
      border-radius: 0 6px 6px 0;
    }
    .actions button {
      width: 100%;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div class="container">
  <div id="testSection">
    <div class="question-text" id="questionText"></div>
    <div id="optionsContainer"></div>
    <div class="navigation">
      <button class="prev-btn" onclick="previousQuestion()">이전</button>
      <button class="next-btn" id="nextBtn" onclick="nextQuestion()" disabled>다음</button>
    </div>
  </div>

  <div class="result-section" id="resultSection">
    <h2>🧠 당신의 신앙유형 결과</h2>
    <div id="typeResult"></div>
    <div id="scoreDetails"></div>
    <div class="actions">
      <button onclick="saveResultImage()">📸 결과 이미지 저장</button>
      <button onclick="shareResult()">🔗 결과 링크 공유</button>
      <button onclick="restartTest()">🔄 다시 검사하기</button>
    </div>
  </div>
</div>

<script>
  const questions = [...]; // 위에서 20문항으로 정리한 questions 배열 전체를 여기에 삽입

  let currentQuestion = 0;
  let answers = [];
  let scores = { R:0, S:0, E:0, W:0, D:0, P:0, O:0, F:0 };

  function loadQuestion() {
    const q = questions[currentQuestion];
    document.getElementById('questionText').textContent = q.text;
    const container = document.getElementById('optionsContainer');
    container.innerHTML = `
      <div class="scale-container">
        <div class="scale-label left">${q.left.text}</div>
        <div class="scale-options">
          <div class="dot" data-score="1"></div>
          <div class="dot" data-score="2"></div>
          <div class="dot" data-score="3"></div>
          <div class="dot" data-score="4"></div>
        </div>
        <div class="scale-label right">${q.right.text}</div>
      </div>
    `;
    document.querySelectorAll('.dot').forEach(dot => {
      dot.addEventListener('click', () => selectOption(parseInt(dot.dataset.score)));
      if (answers[currentQuestion] == dot.dataset.score) dot.classList.add('selected');
    });
    document.getElementById('nextBtn').disabled = (answers[currentQuestion] === undefined);
  }

  function selectOption(score) {
    answers[currentQuestion] = score;
    document.querySelectorAll('.dot').forEach(dot => {
      dot.classList.remove('selected');
      if (parseInt(dot.dataset.score) === score) dot.classList.add('selected');
    });
    document.getElementById('nextBtn').disabled = false;
  }

  function nextQuestion() {
    if (currentQuestion < questions.length - 1) {
      currentQuestion++;
      loadQuestion();
    } else {
      calculateResult();
    }
  }

  function previousQuestion() {
    if (currentQuestion > 0) {
      currentQuestion--;
      loadQuestion();
    }
  }

  function calculateResult() {
    scores = { R:0, S:0, E:0, W:0, D:0, P:0, O:0, F:0 };
    answers.forEach((score, i) => {
      const q = questions[i];
      if (score === 1) scores[q.left.type] += 4;
      if (score === 2) scores[q.left.type] += 3;
      if (score === 3) scores[q.right.type] += 3;
      if (score === 4) scores[q.right.type] += 4;
    });
    const type = `${scores.R > scores.S ? 'R' : 'S'}${scores.E > scores.W ? 'E' : 'W'}${scores.D > scores.P ? 'D' : 'P'}${scores.O > scores.F ? 'O' : 'F'}`;
    document.getElementById('testSection').style.display = 'none';
    document.getElementById('resultSection').style.display = 'block';
    document.getElementById('typeResult').textContent = `🧩 당신의 유형은: ${type}`;
    displayScores();
  }

  function displayScores() {
    const pairs = [
      ['R', 'S', '교제형(R)', '묵상형(S)'],
      ['E', 'W', '체험형(E)', '말씀형(W)'],
      ['D', 'P', '관계중심(D)', '원칙중심(P)'],
      ['O', 'F', '정돈형(O)', '유연형(F)']
    ];
    const container = document.getElementById('scoreDetails');
    container.innerHTML = '';
    pairs.forEach(([left, right, lLabel, rLabel]) => {
      const leftVal = scores[left];
      const rightVal = scores[right];
      const leftPct = (leftVal / 20) * 100;
      const rightPct = (rightVal / 20) * 100;
      const row = document.createElement('div');
      row.innerHTML = `
        <div class="score-labels">
          <strong>${lLabel}</strong> vs <strong>${rLabel}</strong>
        </div>
        <div class="score-bar-container">
          <div class="score-bar-center"></div>
          <div class="score-fill-left" style="width: ${leftPct}%"></div>
          <div class="score-fill-right" style="width: ${rightPct}%"></div>
        </div>
      `;
      container.appendChild(row);
    });
  }

  function saveResultImage() {
    html2canvas(document.getElementById('resultSection')).then(canvas => {
      const link = document.createElement('a');
      link.download = 'fati_result.png';
      link.href = canvas.toDataURL();
      link.click();
    });
  }

  function shareResult() {
    const type = `${scores.R > scores.S ? 'R' : 'S'}${scores.E > scores.W ? 'E' : 'W'}${scores.D > scores.P ? 'D' : 'P'}${scores.O > scores.F ? 'O' : 'F'}`;
    const text = `🙏 FATI 신앙유형검사 결과\n\n나의 유형: ${type}\n\n검사해보기 👉 [URL]`;
    if (navigator.share) {
      navigator.share({ title: 'FATI 검사', text: text });
    } else {
      navigator.clipboard.writeText(text).then(() => alert('결과가 복사되었습니다!'));
    }
  }

  function restartTest() {
    currentQuestion = 0;
    answers = [];
    scores = { R:0, S:0, E:0, W:0, D:0, P:0, O:0, F:0 };
    document.getElementById('resultSection').style.display = 'none';
    document.getElementById('testSection').style.display = 'block';
    loadQuestion();
  }

  // 시작
  window.onload = loadQuestion;
</script>
</body>
</html>
